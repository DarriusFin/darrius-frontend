<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DarriusAI · Inflection Hunter | AI 拐点决策系统</title>

  <!-- Lightweight Charts (required by chart.core.js) -->
  <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>

  <!-- IMPORTANT: tell chart.core.js not to draw small markers (UI overlay draws BIG B/S) -->
  <script>
    window.__OVERLAY_BIG_SIGS__ = true;
  </script>

  <style>
    :root{
      --bg:#0B0F17;
      --bg2:#0A1220;

      --panel:#121A28;
      --panel2:#0F1726;

      --border:rgba(255,255,255,.08);
      --border2:rgba(255,255,255,.10);

      --text:#EAF0F7;
      --muted:#A2B0C2;

      --brand1:#2BE2A6; /* green/teal */
      --brand2:#4CC2FF; /* blue */
      --warn:#FFB86C;
      --danger:#FF5A5A;

      --shadow: 0 18px 45px rgba(0,0,0,.40);
      --shadow2: 0 10px 25px rgba(0,0,0,.28);

      --r12:12px;
      --r14:14px;
      --r18:18px;

      --gradBrand: linear-gradient(90deg, rgba(43,226,166,1) 0%, rgba(76,194,255,1) 100%);
      --gradBrandSoft: linear-gradient(90deg, rgba(43,226,166,.18) 0%, rgba(76,194,255,.18) 100%);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 12% 10%, rgba(76,194,255,.10), transparent 60%),
        radial-gradient(900px 520px at 88% 12%, rgba(43,226,166,.10), transparent 62%),
        radial-gradient(700px 420px at 50% 92%, rgba(255,184,108,.06), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "PingFang SC","Microsoft YaHei", sans-serif;
      overflow:hidden;
    }

    a{ color: rgba(76,194,255,.95); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* ===== Header ===== */
    #topbar{
      height:78px;
      padding:0 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid var(--border);
      background: rgba(10,15,23,.55);
      backdrop-filter: blur(10px);
    }

    #brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width:420px;
    }

    .logo{
      width:46px;height:46px;border-radius:16px;
      background: var(--gradBrandSoft);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 14px 30px rgba(0,0,0,.30);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-65%;
      background: conic-gradient(from 180deg,
        rgba(43,226,166,0),
        rgba(43,226,166,.70),
        rgba(76,194,255,.70),
        rgba(255,90,90,.55),
        rgba(43,226,166,0));
      animation: spin 6.5s linear infinite;
      filter: blur(0.2px);
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    #brandText{ line-height:1.08; }
    #brandLine1{
      font-weight:950;
      letter-spacing:.3px;
      font-size:24px;
    }
    #brandLine1 .accent{
      background: var(--gradBrand);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    #brandLine2{
      margin-top:7px;
      color:var(--muted);
      font-size:13px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .chip{
      font-size:12px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(234,240,247,.90);
      white-space:nowrap;
    }
    .chip.brand{
      border:1px solid rgba(43,226,166,.30);
      background: rgba(43,226,166,.12);
      color: rgba(234,240,247,.95);
    }

    #topRight{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:flex-end;
      min-width:360px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(18,26,40,.65);
      box-shadow: var(--shadow2);
      font-size:12px;
      color: var(--text);
      white-space:nowrap;
      max-width: 42vw;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .dot{
      width:9px;height:9px;border-radius:50%;
      background: var(--brand1);
      box-shadow: 0 0 0 4px rgba(43,226,166,.10);
      flex:0 0 auto;
    }
    .pill.bad .dot{
      background: var(--danger);
      box-shadow: 0 0 0 4px rgba(255,90,90,.10);
    }

    #copyright{
      font-size:12px;
      color: rgba(234,240,247,.68);
      background: rgba(0,0,0,.16);
      padding:9px 12px;
      border:1px solid rgba(255,255,255,.08);
      border-radius:999px;
      white-space:nowrap;
    }

    /* ===== Main Layout ===== */
    #main{
      height: calc(100vh - 78px);
      padding:16px;
      display:grid;
      grid-template-columns: 330px 1fr 380px;
      gap:16px;
      min-height:0;
    }

    .panel{
      background: linear-gradient(180deg, rgba(18,26,40,.92), rgba(15,23,38,.88));
      border: 1px solid var(--border);
      border-radius: var(--r18);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .panelHeader{
      padding:14px 14px 12px 14px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: rgba(0,0,0,.12);
    }
    .panelHeader .h{
      font-weight:900;
      font-size:13px;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .panelHeader .h .tag{
      font-size:11px;
      padding:3px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(234,240,247,.92);
    }
    .panelBody{
      padding:14px;
      overflow:auto;
      min-height:0;
    }

    .card{
      background: rgba(0,0,0,.16);
      border:1px solid rgba(255,255,255,.07);
      border-radius: var(--r14);
      padding:12px;
      margin-bottom:12px;
    }

    .cardTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
      color: var(--muted);
      font-size:12px;
    }
    .cardTitle b{
      color: var(--text);
      font-size:12.5px;
      font-weight:900;
    }

    .small{
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
    }

    .kv{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:8px 10px;
      font-size:12px;
      color: var(--muted);
    }
    .kv b{ color: var(--text); font-weight:900; }

    /* ===== Gauge ===== */
    .gaugeWrap{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .gauge{
      width:160px;height:160px;border-radius:50%;
      background:
        conic-gradient(
          rgba(43,226,166,1) 0deg,
          rgba(76,194,255,1) 120deg,
          rgba(255,90,90,.95) 240deg,
          rgba(43,226,166,1) 360deg
        );
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      position:relative;
      flex:0 0 auto;
      overflow:hidden;
    }
    .gauge::before{
      content:"";
      position:absolute; inset:-38%;
      background: conic-gradient(from 180deg,
        rgba(43,226,166,0),
        rgba(43,226,166,.35),
        rgba(76,194,255,.35),
        rgba(255,90,90,.28),
        rgba(43,226,166,0));
      animation: spin 9s linear infinite;
      filter: blur(1.2px);
      opacity:.75;
      pointer-events:none;
    }
    .gauge::after{
      content:"";
      position:absolute; inset:14px;
      border-radius:50%;
      background: rgba(10,15,23,.92);
      border:1px solid rgba(255,255,255,.06);
      z-index:2;
    }
    .gaugeMask{
      position:absolute; inset:0;
      border-radius:50%;
      z-index:1;
      background: conic-gradient(var(--brand1) 0deg, var(--brand1) 0deg, rgba(255,90,90,.92) 0deg, rgba(255,90,90,.92) 360deg);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .gaugeCenter{
      position:absolute; inset:0;
      z-index:3;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      text-align:center;
    }
    .gaugeCenter .num{
      font-size:36px;
      font-weight:950;
      letter-spacing:.6px;
    }
    .gaugeCenter .lbl{
      margin-top:2px;
      font-size:12px;
      color: var(--muted);
    }

    /* ===== Signal box ===== */
    .signalBox{
      border-radius: var(--r14);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.08);
    }
    .signal{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:12px;
      background: rgba(0,0,0,.16);
      border-left: 4px solid rgba(255,255,255,.10);
    }
    .signal.buy{ border-left-color: var(--brand1); }
    .signal.sell{ border-left-color: var(--danger); }
    .signal.neutral{ border-left-color: rgba(255,255,255,.14); }
    .signal .side{ font-weight:950; letter-spacing:.4px; }
    .signal .meta{ margin-top:6px; font-size:12px; color:var(--muted); line-height:1.35; }

    /* ===== Left footer disclaimer ===== */
    #leftDisclaimer{
      margin-top:12px;
      padding-top:12px;
      border-top:1px solid rgba(255,255,255,.06);
      font-size:11px;
      line-height:1.55;
      color: rgba(234,240,247,.74);
    }
    #leftDisclaimer b{ color: rgba(234,240,247,.92); }
    #leftDisclaimer .mut{ color: rgba(234,240,247,.62); }

    /* ===== Center Chart ===== */
    #chartPanel .panelBody{ padding:0; }

    /* ✅ 关键修复：让主图占满剩余高度，Mutant 固定在中间面板最底部 */
    #chartPanel .panelBody{
      display:flex;
      flex-direction:column;
      height:100%;
      min-height:0;
      overflow:hidden; /* 不让中间乱滚，避免 Mutant 被顶上去 */
    }

    #chartTop{
      padding:10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.14);
      gap:12px;
    }
    #priceLine{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      min-width: 260px;
    }
    #priceLine .sym{
      font-size:13px;
      color: var(--muted);
      font-weight:950;
      letter-spacing:.3px;
    }
    #hintText{
      font-size:12px;
      color: var(--muted);
      max-width:55%;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    #tfQuick{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .tfBtn{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      color: rgba(234,240,247,.90);
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition: filter .15s ease, transform .06s ease;
    }
    .tfBtn:hover{ filter: brightness(1.06); }
    .tfBtn:active{ transform: translateY(1px); }
    .tfBtn.active{
      border-color: rgba(76,194,255,.40);
      box-shadow: 0 0 0 4px rgba(76,194,255,.10);
      background: rgba(76,194,255,.10);
    }

    #chartWrap{
      position:relative;
      width:100%;
      flex: 1 1 auto;   /* ✅ 主图吃掉剩余高度 */
      min-height: 0;    /* ✅ 允许缩放，不撑开把 Mutant 顶上去 */
    }
    #chart{
      position:absolute; inset:0;
      width:100%;
      height:100%;
    }

    /* Overlay host (market.pulse.js will create its own #bsOverlayLayer inside chart host) */
    #sigOverlay{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:20;
    }

    /* ✅ Mutant 面板：固定在中间面板底部 */
    #mutantPanel{
      width:100%;
      flex: 0 0 160px;       /* ✅ 固定高度（你要更高可调） */
      margin-top:10px;
      border-radius:14px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      overflow:hidden;
      position:relative;
    }
    #mutantTitle{
      position:absolute;
      left:10px; top:8px;
      font-size:12px;
      letter-spacing:.2px;
      color: rgba(234,240,247,.72);
      z-index:2;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      pointer-events:none;
    }

    /* ✅ FIX: 你现在的 darrius.mutant.js 会在 canvas 里自己画标题，
       DOM 这个 #mutantTitle 会导致出现两行“Darrius Mutant”，所以隐藏它即可 */
    #mutantTitle{ display:none !important; }

    /* ===== Right Controls ===== */
    .field{ margin-bottom:10px; }
    .label{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
      font-size:12px;
      color: var(--muted);
    }
    .label b{ color: var(--text); }

    input, select{
      width:100%;
      background: rgba(0,0,0,.24);
      border:1px solid rgba(255,255,255,.10);
      color: var(--text);
      padding:10px 10px;
      border-radius: var(--r12);
      outline:none;
      font-size:13px;
    }
    select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(234,240,247,.9) 50%),
        linear-gradient(135deg, rgba(234,240,247,.9) 50%, transparent 50%),
        linear-gradient(to right, transparent, transparent);
      background-position:
        calc(100% - 18px) calc(1em + 2px),
        calc(100% - 13px) calc(1em + 2px),
        0 0;
      background-size:5px 5px, 5px 5px, 100% 100%;
      background-repeat:no-repeat;
      padding-right:34px;
    }
    select option{
      background:#0B0F17;
      color:var(--text);
    }
    input::placeholder{ color: rgba(162,176,194,.80); }
    input:focus, select:focus{
      border-color: rgba(76,194,255,.50);
      box-shadow: 0 0 0 4px rgba(76,194,255,.12);
    }

    .btn{
      width:100%;
      border:0;
      color:#081119;
      font-weight:950;
      letter-spacing:.3px;
      padding:12px 12px;
      border-radius: var(--r12);
      cursor:pointer;
      background: var(--gradBrand);
      box-shadow: var(--shadow2);
      transition: transform .06s ease, filter .15s ease;
    }
    .btn:hover{ filter: brightness(1.04); }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .btnGhost{
      width:100%;
      border:1px solid rgba(255,255,255,.10);
      color: var(--text);
      font-weight:900;
      padding:11px 12px;
      border-radius: var(--r12);
      cursor:pointer;
      background: rgba(0,0,0,.14);
      transition: transform .06s ease, filter .15s ease;
    }
    .btnGhost:hover{ filter: brightness(1.05); }
    .btnGhost:active{ transform: translateY(1px); }
    .btnGhost:disabled{ opacity:.55; cursor:not-allowed; }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }

    .note{
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
    }
    .note b{ color: var(--text); }

    .hidden{ display:none !important; }

    /* ✅ 你要求：右侧 Manage 按钮背景和 Start 一样（纯 UI，不动订阅逻辑） */
    #manageBtn{
      border: 0 !important;
      color:#081119 !important;
      font-weight:950 !important;
      letter-spacing:.3px !important;
      background: var(--gradBrand) !important;
      box-shadow: var(--shadow2) !important;
    }
    #manageBtn:hover{ filter: brightness(1.04); }
    #manageBtn:active{ transform: translateY(1px); }
    #manageBtn:disabled{ opacity:.55; cursor:not-allowed; }

    @media (max-width: 1180px){
      body{ overflow:auto; }
      #main{
        height:auto;
        grid-template-columns: 1fr;
      }
      #chartWrap{ height: 560px; }
      #brand{ min-width:0; }
      #topRight{ min-width:0; }
      #tfQuick{ justify-content:flex-start; }
      #chartPanel .panelBody{ overflow:auto; } /* 小屏允许滚动 */
    }
  </style>
  <style>
  /* ……你原来已有的全部 CSS …… */

  /* ===== Subscription Access Badge ===== */
  .accessBadge {
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: .3px;
  }

  .accessBadge.ACTIVE {
    background: rgba(46, 204, 113, .15);
    color: #2ecc71;
  }

  .accessBadge.TRIAL {
    background: rgba(241, 196, 15, .18);
    color: #f1c40f;
  }

  .accessBadge.EXPIRED {
    background: rgba(231, 76, 60, .18);
    color: #e74c3c;
  }

  .accessBadge.UNKNOWN {
    background: rgba(149, 165, 166, .18);
    color: #95a5a6;
  }

  .hidden {
    display: none;
  }
</style>
</head>

<body>
  <!-- Header -->
  <div id="topbar">
    <div id="brand">
      <div class="logo"></div>
      <div id="brandText">
        <div id="brandLine1">
          <span class="accent">DarriusAI</span> · Inflection Hunter
        </div>
        <div id="brandLine2">
          <span class="chip brand">AI 拐点决策系统</span>
          <span class="chip">拐点猎手</span>
        </div>
      </div>
    </div>

    <div id="topRight">
      <!-- chart.core.js 会更新这里的内容（数据源强提示/Ready/URL等） -->
      <div id="statusBadge" class="pill">
        <span class="dot"></span>
        <span id="statusText">Ready · 前端就绪</span>
      </div>
      <div id="copyright">© <span id="yearNow"></span> Darrius FinTech Inc. All Rights Reserved.</div>
    </div>
  </div>

  <div id="main">
    <!-- LEFT -->
    <div class="panel" id="leftPanel">
      <div class="panelHeader">
        <div class="h">Market Pulse · 市场情绪 <span class="tag" id="pulseTag">LIVE</span></div>
      </div>
      <div class="panelBody">
        <div class="card">
          <div class="gaugeWrap">
            <div class="gauge" id="pulseGauge">
              <div class="gaugeMask" id="pulseGaugeMask"></div>
              <div class="gaugeCenter">
                <div class="num" id="pulseScore">—</div>
                <div class="lbl">Sentiment</div>
              </div>
            </div>
            <div style="flex:1">
              <div class="kv">
                <span>Bullish</span><b id="bullPct">—</b>
                <span>Bearish</span><b id="bearPct" style="color:var(--danger)">—</b>
                <span>Neutral</span><b id="neuPct">—</b>
                <span>Net Inflow</span><b id="netInflow" style="color:var(--brand1)">—</b>
              </div>

              <!-- ✅（按你“黄框删”要求）保留一句精简说明： -->
              <div class="small" style="margin-top:10px">
                <b>Note:</b> Derived from the main chart only.<br/>
                <b>说明：</b>完全由主图派生。
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle"><b>Risk Copilot · 风险助手</b><span class="small" id="riskMode">Auto</span></div>
          <div class="kv">
            <span>Entry · 入场</span><b id="riskEntry">—</b>
            <span>Stop · 止损</span><b id="riskStop" style="color:var(--danger)">—</b>
            <span>Targets · 目标</span><b id="riskTargets">—</b>
            <span>Confidence · 强度</span><b id="riskConf">—</b>
            <span>Backtest WinRate · 回测胜率</span><b id="riskWR">—</b>
          </div>
        </div>

        <div class="signalBox">
          <div class="signal neutral" id="signalRow">
            <div>
              <div class="side" id="signalSide">Waiting…</div>
              <div class="meta" id="signalMeta">Waiting for confirmation…<br/>等待确认…</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:950" id="signalPx">—</div>
              <div class="meta" id="signalTf">TF: —</div>
            </div>
          </div>
        </div>

        <!-- Affiliate -->
        <div class="card" id="affiliateCard" style="margin-top:12px">
          <div class="cardTitle"><b>Affiliate · 推荐人</b><span class="small">入口</span></div>
          <button class="btnGhost" id="affiliateBtn">Affiliate / 推荐入口</button>
          <div class="note" style="margin-top:10px">
            <b>Note:</b> Commission terms are disclosed only in the dashboard and agreement.<br/>
            <b>说明：</b>返佣比例与结算规则仅在后台与合同中呈现。
          </div>
        </div>

        <!-- Compliance Disclaimer（保留） -->
        <div id="leftDisclaimer">
          <div>
            <b>Disclaimer:</b> Informational use only. Not investment advice. No offer or solicitation to buy/sell any security, futures, FX, crypto, or other financial instrument.
            Signals are algorithmic estimates and may be inaccurate, delayed, or incomplete. Past performance is not indicative of future results. You are solely responsible for your trading decisions and risk.
          </div>
          <div style="margin-top:8px">
            <b>免责声明：</b> 本系统仅用于信息展示，不构成任何投资建议、要约或招揽。算法信号可能存在误差、延迟或不完整；历史表现不代表未来收益。任何交易决策与风险均由用户自行承担。
          </div>
          <div class="mut" style="margin-top:8px">
            Links:
            <a href="https://darrius.ai" target="_blank" rel="noreferrer">darrius.ai</a> ·
            <a href="#" onclick="alert('后续可接：Terms / Privacy / Contact');return false;">Terms</a> ·
            <a href="#" onclick="alert('后续可接：Privacy Policy');return false;">Privacy</a> ·
            <a href="#" onclick="alert('support@darrius.ai');return false;">Support</a>
          </div>
        </div>
      </div>
    </div>

    <!-- CENTER -->
    <div class="panel" id="chartPanel">
      <div id="chartTop">
        <div id="priceLine">
          <span class="sym" id="symText">—</span>
          <span id="priceText">—</span>
        </div>
        <div id="hintText">Loading…</div>
        <div id="tfQuick">
          <button class="tfBtn" data-tf="5m">5m</button>
          <button class="tfBtn" data-tf="15m">15m</button>
          <button class="tfBtn" data-tf="30m">30m</button>
          <button class="tfBtn" data-tf="1h">1h</button>
          <button class="tfBtn" data-tf="4h">4h</button>
          <button class="tfBtn" data-tf="1d">1D</button>
          <button class="tfBtn" data-tf="1w">1W</button>
          <button class="tfBtn" data-tf="1M">1M</button>
        </div>
      </div>

      <div class="panelBody">
        <div id="chartWrap">
          <div id="chart"></div>
          <!-- 保留这个占位层（不影响 market.pulse.js 自建 #bsOverlayLayer） -->
          <div id="sigOverlay"></div>
        </div>

        <!-- ✅ Mutant：固定在中间面板最底部（只保留一个 mutantPanel，杜绝崩溃） -->
        <div id="mutantPanel">
          <div id="mutantTitle">Darrius Mutant</div>
          <!-- Darrius Mutant canvas rendered here by js/darrius.mutant.js -->
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="panel" id="rightPanel">
      <div class="panelHeader">
        <div class="h">Control Center · 控制台</div>
      </div>

      <div class="panelBody">
        <!-- Data Source -->
        <div class="card">
          <div class="cardTitle"><b>Data Source · 数据源</b><span class="small">预留接口</span></div>
          <div class="field">
            <div class="label"><span>Source · 来源</span><span class="small">第三方实盘</span></div>
            <select id="dataSource">
              <option value="demo">Demo (Local)</option>
              <option value="provider">3rd-Party Provider (Reserved)</option>
            </select>
          </div>

          <div class="note">
            <b>Note:</b> Live data should be proxied through backend.<br/>
            <b>说明：</b>实盘通过后端代理获取。
          </div>
        </div>

        <!-- Market Control -->
        <div class="card">
          <div class="cardTitle"><b>Market · 品种与周期</b><span class="small">Chart</span></div>

          <div class="field">
            <div class="label"><span>Symbol · 品种</span><span class="small">(如 BTCUSDT)</span></div>
            <input id="symbol" value="BTCUSDT"/>
          </div>

          <div class="field">
            <div class="label"><span>Timeframe · 周期</span></div>
            <select id="tf">
              <option value="5m">5m · 5分钟</option>
              <option value="15m">15m · 15分钟</option>
              <option value="30m">30m · 30分钟</option>
              <option value="1h">1h · 1小时</option>
              <option value="4h">4h · 4小时</option>
              <option value="1d" selected>1d · 日线</option>
              <option value="1w">1w · 周线</option>
              <option value="1M">1M · 月线</option>
            </select>
          </div>

          <button class="btn" id="loadBtn">Symbol Load · 品种加载</button>

          <div class="row2">
            <label class="btnGhost" style="display:flex;align-items:center;justify-content:center;gap:8px;">
              <input type="checkbox" id="tgEMA" checked style="width:auto;margin:0;transform:translateY(1px)">
              EMA
            </label>
            <label class="btnGhost" style="display:flex;align-items:center;justify-content:center;gap:8px;">
              <input type="checkbox" id="tgAux" checked style="width:auto;margin:0;transform:translateY(1px)">
              AUX
            </label>
          </div>

          <div class="note" style="margin-top:8px">
            <b>Note:</b> EMA/AUX parameters are internal.<br/>
            <b>说明：</b>EMA/AUX 参数为内部策略要素，系统按周期自动适配。
          </div>
        </div>

        <!-- Subscription（保持原结构/ID，不动逻辑） -->
        <div class="card">
          <div class="cardTitle">
            <b>Subscription · 订阅选择</b>
            <span class="small" id="planStatus">从后端拉取…</span>
          </div>

          <div class="note" style="margin-top:-2px;margin-bottom:10px">
            <b>Note:</b> Trial requires a valid card. If payment is not completed when the trial ends, access will be disabled automatically.<br/>
            <b>说明：</b>试用需绑定信用卡；到期未付费会自动取消权限。
          </div>

          <div class="field">
            <div class="label"><span><b>User ID</b> · 用户ID</span><span class="small">（必填）</span></div>
            <input id="userId" placeholder="例如：user_123 / 你的系统用户ID"/>
          </div>

          <div class="field">
            <div class="label"><span>Email · 邮箱</span><span class="small">（必填）</span></div>
            <input id="email" placeholder="用于收据 / 首次兜底匹配"/>
          </div>

          <div class="field">
            <div class="label"><span>Plan · 套餐</span><span class="small">—</span></div>
            <select id="planSelect">
              <option value="">Loading…</option>
            </select>
          </div>

          <div class="row2" style="margin-top:0">
            <button class="btn" id="subscribeBtn" disabled>Order Start ·  订单开通</button>
            <button class="btnGhost" id="manageBtn" disabled>Order Manage · 订单管理</button>
          </div>

          <div class="note" style="margin-top:10px">
            <b>Subscription Status：</b>
<span id="subStatusText"
      style="margin-left:6px;color:rgba(234,240,247,.88)">
  Unknown
</span>
<span id="accessBadge"
      class="accessBadge hidden"
      style="margin-left:8px;">
  UNKNOWN
</span>
          </div>
        </div>

        <!-- Share & Export -->
        <div class="card">
          <div class="cardTitle"><b>Share & Export · 分享与导出</b><span class="small">Utilities</span></div>
          <button class="btnGhost" id="copyLinkBtn">Copy Share Link · 复制分享链接</button>
          <div style="height:10px"></div>
          <button class="btnGhost" id="exportBtn">Export PNG · 导出图片（含图表）</button>
          <div class="note" style="margin-top:10px">
            <b>Note:</b> Export depends on browser canvas support. For maximum stability, move export to backend rendering.<br/>
            <b>说明：</b>导出依赖浏览器对 canvas 截图支持；若受限，可改为后端渲染导出（更稳定）。
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- =========================
       GLOBALS (must be before external JS if they read API_BASE on load)
       ========================= -->
  <script>
    window.API_BASE = "https://darrius-api.onrender.com";
    document.getElementById("yearNow").textContent = String(new Date().getFullYear());
  </script>

  <!-- ✅ Step A：ID 重复/误绑自检（不改任何业务逻辑，只输出诊断） -->
  <script>
    (function(){
      function findDuplicateIds(){
        const nodes = Array.from(document.querySelectorAll("[id]"));
        const map = new Map();
        for (const n of nodes){
          const id = n.id;
          if (!id) continue;
          if (!map.has(id)) map.set(id, []);
          map.get(id).push(n);
        }
        const dupes = [];
        for (const [id, arr] of map.entries()){
          if (arr.length > 1) dupes.push({ id, count: arr.length, nodes: arr });
        }
        return dupes;
      }

      const dupes = findDuplicateIds();
      window.__DARRIUS_ID_DUPES__ = dupes.map(d => ({ id: d.id, count: d.count }));

      // sameAsEntry 检测：判断 riskEntry/riskStop/riskTargets/riskConf/riskWR 是否意外指向同一个节点
      window.sameAsEntry = function(){
        const e  = document.getElementById("riskEntry");
        const s  = document.getElementById("riskStop");
        const t  = document.getElementById("riskTargets");
        const c  = document.getElementById("riskConf");
        const wr = document.getElementById("riskWR");
        if (!e || !s || !t || !c || !wr) return { ok:false, reason:"missing ids", ids:{e:!!e,s:!!s,t:!!t,c:!!c,wr:!!wr} };
        const set = new Set([e, s, t, c, wr]);
        return { ok:true, same: (set.size !== 5), size:set.size };
      };

      if (dupes.length){
        console.warn("[ID] Duplicate IDs found:", dupes.map(d => d.id));
      } else {
        console.log("[ID] No duplicate IDs.");
      }
      console.log("[ID] sameAsEntry():", window.sameAsEntry());
    })();
  </script>

  <!-- =========================
       SCRIPTS (ORDER IS CRITICAL)
       不动订阅/支付：subscription.js + boot.js 保持原
       ========================= -->

  <!-- 1) 主图系统（冻结，不动） -->
  <script src="js/chart.core.js?v=20260122"></script>

  <!-- 2) Market Pulse UI（你已替换为 STABLE COMPAT v2026.01.22） -->
  <script src="js/market.pulse.js?v=20260122"></script>

  <!-- 3) Mutant（单独文件） -->
  <script src="js/darrius.mutant.js?v=20260122"></script>

  <!-- 4) 订阅系统（保持原） -->
  <script src="js/subscription.js?v=20260122"></script>

  <script src="js/referral.client.js"></script>
  
  <!-- 5) 启动/绑定按钮（保持原） -->
  <script src="js/boot.js?v=20260122"></script>
  
  <script src="js/referral.client.js"></script>

  <script>
(() => {
  function ready(fn){
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
    else fn();
  }

  ready(() => {
    const card = document.getElementById('affiliateCard');
    if (!card) return;

    // 让卡片可点击（视觉+交互）
    card.style.cursor = 'pointer';
    card.style.pointerEvents = 'auto';

    // 避免重复绑定
    if (card.__AFF_BOUND__) return;
    card.__AFF_BOUND__ = true;

    card.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();

      // TODO: 这里换成你的真实入口
      // 方案A：跳转到推荐人页面
      window.location.href = '/affiliate.html';

      // 方案B：如果你是弹窗/面板
      // window.dispatchEvent(new CustomEvent('darrius:openAffiliate'));
    }, true);
  });
})();
</script>

</body>
</html>
